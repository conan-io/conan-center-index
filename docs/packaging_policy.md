# Packaging Policy

This document gathers all the relevant information regarding the general lines to follow while creating new recipes that will eventually be
part of this repository.

<!-- toc -->
## Contents

  * [Sources](#sources)
  * [Settings](#settings)
  * [Options](#options)<!-- endToc -->


## Sources

**Origin of sources:** Library sources should come from an official origin like the library source code repository or the official
release/download webpage.

**Building from sources:** Recipes should always build packages from library sources.

**Sources not accessible:**

- Library sources that are not publicly available will not be allowed in this repository even if the license allows their redistribution.

- If library sources cannot be downloaded from their official origin or cannot be consumed directly due to their
  format, the recommendation is to contact the publisher and ask them to provide the sources in a way/format that can be consumed
  programmatically.

- In case of needing those binaries to use them as a "build require" for some library, we will consider following the approach of adding it
  as a system recipe (`<build_require>/system`) and making those binaries available in the CI machines (if the license allows it).


## Settings

All recipes should list the four settings `os`, `arch`, `compiler` and `build_type` so Conan will compute a different package ID
for each combination. There are some particular cases for this general rule:
 * **Recipes for _header only_ libraries** might omit the `settings` attibute, but in any case they should add
  
   ```python
   def package_id(self):
      self.info.header_only()
   ```

 * **Recipes that provide applications** (`b2`, `cmake`, `make`,...) that are generally used as a _build requires_, must list all
   the settings as well, but they should remove the `compiler` one in the corresponding method unless the recipe provides also
   libraries that are consumed by other packages:

   ```python
   def package_id(self):
      del self.settings.compiler
   ```
   
   Removing the `compiler` setting reduces the number of configurations generated by the CI, reducing the time and workload and, at the
   same time, demonstrates the power of Conan behind the package ID logic.

   > Note.- Intentionally, the `build_type` setting should not be removed from the package ID in this case. Preserving this
   > setting will ensure that the package ID for Debug and Release configurations will be different and both binaries can be
   > available in the Conan cache at the same time. This enable consumers to switch from one configuration to the other in the case
   > they want to run or to debug those executables.


## Options

Recipes can list any number of options with any meaning, and defaults are up to the recipe itself. The CI cannot enforce anything
in this direction. However, there are a couple of options that have a special meaning for the CI:

 * `shared` (with values `True` or `False`). The CI inspects the recipe looking for this option. If it is found, it will
   generate all the configurations with values `shared=True` and `shared=False`.

   > Note.- The CI applies `shared=True` only to the package being built, while every other requirement will use their defaults
   > (typically `shared=False`). It's important to keep this in mind when trying to consume shared packages from ConanCenter
   > as their requirements were linked inside the shared library. See [FAQs](faqs.md#how-to-consume-a-graph-of-shared-libraries) for more information.

 * `header_only` (with values `True` or `False`). If the CI detects this option, it will generate all the configurations for the
   value `header_only=False` and add one more configuration with `header_only=True`. **Only one
   package** will be generated for `header_only=True`, so it is crucial that the package is actually a _header only_ library, with header files only (no libraries or executables inside).

   Recipes with such option should include the following in their `package_id` method

   ```python
   def package_id(self):
      if self.options.header_only:
         self.info.header_only()
   ```
   
   ensuring that, when the option is active, the recipe ignores all the settings and only one package ID is generated.
