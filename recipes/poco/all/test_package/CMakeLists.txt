cmake_minimum_required(VERSION 3.1)
project(test_package LANGUAGES CXX)

option(TEST_UTIL "Test Util" ON)
option(TEST_CRYPTO "Test crypto" ON)
option(TEST_NET "Test Net" ON)
option(TEST_NETSSL "Test NetSSL" ON)
option(TEST_SQLITE "Test Sqlite" ON)
option(TEST_ENCODINGS "Test Encodings" ON)
option(TEST_JWT "Test JWT" ON)
option(TEST_PROMETHEUS "Test Prometheus" ON)

set(CMAKE_CXX_STANDARD 11)

set(POCO_COMPONENTS Foundation)
if(TEST_UTIL)
    list(APPEND POCO_COMPONENTS Util)
endif()
if(TEST_CRYPTO)
    list(APPEND POCO_COMPONENTS Crypto)
endif()
if(TEST_NET)
    list(APPEND POCO_COMPONENTS Net)
endif()
if(TEST_NETSSL)
    list(APPEND POCO_COMPONENTS NetSSL)
endif()
if(TEST_SQLITE)
    list(APPEND POCO_COMPONENTS DataSQLite)
endif()
if(TEST_ENCODINGS)
    list(APPEND POCO_COMPONENTS Encodings)
endif()
if(TEST_JWT)
    list(APPEND POCO_COMPONENTS JWT)
endif()
if(TEST_PROMETHEUS)
    list(APPEND POCO_COMPONENTS Prometheus)
endif()

find_package(Poco REQUIRED ${POCO_COMPONENTS} CONFIG)

add_executable(core test_core.cpp)
target_link_libraries(core Poco::Foundation)

if(TEST_UTIL)
    add_executable(util test_util.cpp)
    target_link_libraries(util Poco::Util)
    if(MINGW)
        target_link_options(util PRIVATE -municode)
    endif()
endif()

if(TEST_CRYPTO)
    add_executable(tcrypto test_crypto.cpp)
    target_link_libraries(tcrypto Poco::Crypto)
    set_property(TARGET tcrypto PROPERTY OUTPUT_NAME "crypto")
endif()

if(TEST_NET)
    add_executable(net test_net.cpp)
    target_link_libraries(net Poco::Net)

    if(TEST_UTIL)
        add_executable(net_2 test_net_2.cpp)
        target_link_libraries(net_2 Poco::Net Poco::Util)
    endif()
endif()

if(TEST_NETSSL)
    add_executable(netssl test_netssl.cpp)
    target_link_libraries(netssl Poco::NetSSL)
endif()

if(TEST_SQLITE)
    add_executable(sqlite test_sqlite.cpp)
    target_link_libraries(sqlite Poco::DataSQLite)
endif()

if(TEST_ENCODINGS)
    add_executable(encodings test_encodings.cpp)
    target_link_libraries(encodings Poco::Encodings)
endif()

if(TEST_JWT)
    add_executable(jwt test_jwt.cpp)
    target_link_libraries(jwt Poco::JWT)
endif()

if(TEST_PROMETHEUS)
    add_executable(prometheus test_prometheus.cpp)
    target_link_libraries(prometheus Poco::Prometheus)
endif()
