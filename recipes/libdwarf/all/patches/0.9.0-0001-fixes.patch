diff --git a/src/bin/dwarfdump/CMakeLists.txt b/src/bin/dwarfdump/CMakeLists.txt
index 6d2c328..bc10581 100644
--- a/src/bin/dwarfdump/CMakeLists.txt
+++ b/src/bin/dwarfdump/CMakeLists.txt
@@ -68,7 +68,7 @@ target_compile_options(dwarfdump PRIVATE ${DW_FWALL})
 
 target_link_libraries(dwarfdump PRIVATE dwarf) 
 
-if(${CMAKE_SIZEOF_VOID_P} EQUAL 8)
+if(0)
 	set(SUFFIX 64)
 endif()
 set(LIBDIR lib${SUFFIX})
diff --git a/src/lib/libdwarf/CMakeLists.txt b/src/lib/libdwarf/CMakeLists.txt
index 4ad5c4f..22143c0 100644
--- a/src/lib/libdwarf/CMakeLists.txt
+++ b/src/lib/libdwarf/CMakeLists.txt
@@ -108,10 +108,14 @@ target_include_directories(dwarf PUBLIC
     $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}>
   )
 if(ZLIB_FOUND AND ZSTD_FOUND)
-  target_link_libraries(dwarf PRIVATE  ZLIB::ZLIB ZSTD::ZSTD ) 
+    if (TARGET zstd::libzstd_shared)
+        target_link_libraries(dwarf PRIVATE  ZLIB::ZLIB zstd::libzstd_shared)
+    else()
+        target_link_libraries(dwarf PRIVATE  ZLIB::ZLIB zstd::libzstd_static)
+    endif()
 endif()
 
-set(SUFFIX $<$<EQUAL:${CMAKE_SIZEOF_VOID_P},8>:64>)
+#set(SUFFIX $<$<EQUAL:${CMAKE_SIZEOF_VOID_P},8>:64>)
 set(LIBDIR lib${SUFFIX})
 set(BINDIR bin${SUFFIX})
 
@@ -120,7 +124,7 @@ install(TARGETS dwarf
 	LIBRARY DESTINATION ${LIBDIR}
 	ARCHIVE DESTINATION ${LIBDIR})
 
-configure_file(libdwarf.pc.cmake libdwarf.pc @ONLY )
+#configure_file(libdwarf.pc.cmake libdwarf.pc @ONLY )
 
 # The install has to be here, not in
 # another CMakeLists.txt  to make install work properly
@@ -145,6 +149,6 @@ install(
 install(
     FILES ${CMAKE_CURRENT_SOURCE_DIR}/dwarf.h
     DESTINATION include/libdwarf)
-install( FILES ${PROJECT_BINARY_DIR}/src/lib/libdwarf/libdwarf.pc
-    DESTINATION lib/pkgconfig
-)
+#install( FILES ${PROJECT_BINARY_DIR}/src/lib/libdwarf/libdwarf.pc
+#    DESTINATION lib/pkgconfig
+#)
diff --git a/src/lib/libdwarf/libdwarf.h b/src/lib/libdwarf/libdwarf.h
index ed3d1d0..91f2fd8 100644
--- a/src/lib/libdwarf/libdwarf.h
+++ b/src/lib/libdwarf/libdwarf.h
@@ -51,7 +51,7 @@
 #endif /* DW_API */
 
 #ifndef LIBDWARF_STATIC
-# if defined(_WIN32) || defined(__CYGWIN__)
+# if defined(LIBDWARF_SHARED) && (defined(_WIN32) || defined(__CYGWIN__))
 #  ifdef LIBDWARF_BUILD
 #   define DW_API __declspec(dllexport)
 #  else /* !LIBDWARF_BUILD */
