--- ports/cmake/src/libmpg123/CMakeLists.txt
+++ ports/cmake/src/libmpg123/CMakeLists.txt
@@ -47,7 +47,7 @@
     "${CMAKE_CURRENT_SOURCE_DIR}/../../../../src/libmpg123/$<$<BOOL:${LFS_SENSITIVE}>:lfs_wrap.c>"
     $<TARGET_OBJECTS:compat>)
 
-if((MSVC AND CMAKE_GENERATOR_PLATFORM STREQUAL "x64") OR (NOT MSVC AND CMAKE_SYSTEM_PROCESSOR MATCHES "([xX]86_|AMD|amd)64"))
+if(CMAKE_SYSTEM_PROCESSOR MATCHES "(x|X|AMD|amd)64" AND CMAKE_SIZEOF_VOID_P STREQUAL "8")
     if(HAVE_FPU)
         set(PLATFORM_DEFINITIONS OPT_MULTI OPT_X86_64 OPT_AVX OPT_GENERIC OPT_GENERIC_DITHER)
         set(PLATFORM_SOURCES
@@ -80,7 +80,7 @@
     else()
         set(PLATFORM_DEFINITIONS OPT_GENERIC)
     endif()
-elseif((MSVC AND CMAKE_GENERATOR_PLATFORM MATCHES "|Win32") OR (NOT MSVC AND CMAKE_SYSTEM_PROCESSOR MATCHES "i.86"))
+elseif(CMAKE_SYSTEM_PROCESSOR MATCHES "(x|X|AMD|amd)64|i.86" AND CMAKE_SIZEOF_VOID_P STREQUAL "4")
     if(TRUE)
         set(PLATFORM_DEFINITIONS OPT_I386)
         target_sources(${TARGET} PRIVATE
@@ -126,8 +126,10 @@
     endif()
-    if((MSVC AND CMAKE_GENERATOR_PLATFORM STREQUAL "x64") OR (NOT MSVC AND CMAKE_SYSTEM_PROCESSOR MATCHES "([xX]86_|AMD|amd)64"))
+    if(CMAKE_SYSTEM_PROCESSOR MATCHES "(x|X|AMD|amd)64" AND CMAKE_SIZEOF_VOID_P STREQUAL "8")
         set(MACHINE amd64)
+        set(YASM_OBJECT_FORMAT win64)
-    elseif((MSVC AND CMAKE_GENERATOR_PLATFORM MATCHES "|Win32") OR (NOT MSVC AND CMAKE_SYSTEM_PROCESSOR MATCHES "i.86"))
+    elseif(CMAKE_SYSTEM_PROCESSOR MATCHES "(x|X|AMD|amd)64|i.86" AND CMAKE_SIZEOF_VOID_P STREQUAL "4")
         set(MACHINE x86)
+        set(YASM_OBJECT_FORMAT win32)
     endif()
     list(TRANSFORM PLATFORM_DEFINITIONS PREPEND /D)
     foreach(FILE ${PLATFORM_SOURCES})
