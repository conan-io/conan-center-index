# SConstruct
import os

AddOption("--conan-compiler",
          dest="conan_tool",
          default=None,
          type="string",
          nargs=1,
          action="store",
          metavar="COMPILER",
          help="conan compiler type")

env_tools = None
conan_tool = GetOption("conan_tool")
print("conan-compiler tool is {}".format(conan_tool))
if conan_tool:
    if not env_tools:
        env_tools = []
    env_tools.append(conan_tool)

# https://github.com/SCons/scons/issues/1456
env_tools = None

env = Environment(tools=env_tools,
                  #CC=os.environ.get("CC", None),
                  #CXX=os.environ.get("CXX", None),
                  ENV={"PATH": os.environ["PATH"]})

conan = SConscript("SConscript_conan")
if not conan:
    print("File `SConscript_conan` is missing.")
    print("It should be generated by running `conan install`.")
    sys.exit(1)

flags = conan["conan"]
env.MergeFlags(flags)

print("CC is: {}".format(env.subst('$CC')))

test_package = env.Program(["test_package.c"])
