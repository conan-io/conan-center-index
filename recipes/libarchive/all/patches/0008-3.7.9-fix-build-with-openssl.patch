diff --git a/CMakeLists.txt b/CMakeLists.txt
index 190c1bf..444c3c2 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -894,7 +894,7 @@ MACRO(CHECK_CRYPTO ALGORITHMS IMPLEMENTATION)
 	    SET(TRY_CRYPTO_REQUIRED_INCLUDES
 	      "${TRY_CRYPTO_REQUIRED_INCLUDES};${OPENSSL_INCLUDE_DIR}")
 	    SET(TRY_CRYPTO_REQUIRED_LIBS
-	        "-DLINK_LIBRARIES:STRING=${OPENSSL_LIBRARIES}")
+	        "${OPENSSL_SSL_LIBRARY};${OPENSSL_CRYPTO_LIBRARY}")
 	ELSEIF("${IMPLEMENTATION}" MATCHES "^MBEDTLS$" AND MBEDTLS_FOUND)
 	    SET(TRY_CRYPTO_REQUIRED_INCLUDES
 	      "${TRY_CRYPTO_REQUIRED_INCLUDES};${MBEDTLS_INCLUDE_DIRS}")
@@ -939,14 +939,24 @@ main(int argc, char **argv)
 	FILE(WRITE "${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp/check_crypto_md.c" "${SOURCE}")
 	MESSAGE(STATUS "Checking support for ARCHIVE_CRYPTO_${ALGORITHM}_${IMPLEMENTATION}")
 
-	TRY_COMPILE(ARCHIVE_CRYPTO_${ALGORITHM}_${IMPLEMENTATION}
-	  ${CMAKE_BINARY_DIR}
-	  ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp/check_crypto_md.c
-	  CMAKE_FLAGS
-	   "${TRY_CRYPTO_REQUIRED_LIBS}"
-	   "${TRY_CRYPTO_REQUIRED_INCLUDES}"
-	  OUTPUT_VARIABLE OUTPUT)
-
+  IF ("${IMPLEMENTATION}" MATCHES "^OPENSSL$" AND OPENSSL_FOUND)
+    TRY_COMPILE(ARCHIVE_CRYPTO_${ALGORITHM}_${IMPLEMENTATION}
+      ${CMAKE_BINARY_DIR}
+      ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp/check_crypto_md.c
+	    CMAKE_FLAGS
+	     "${TRY_CRYPTO_REQUIRED_INCLUDES}"
+      LINK_LIBRARIES
+       "${TRY_CRYPTO_REQUIRED_LIBS}"
+      OUTPUT_VARIABLE OUTPUT)
+  ELSE()
+    TRY_COMPILE(ARCHIVE_CRYPTO_${ALGORITHM}_${IMPLEMENTATION}
+      ${CMAKE_BINARY_DIR}
+      ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp/check_crypto_md.c
+      CMAKE_FLAGS
+       "${TRY_CRYPTO_REQUIRED_LIBS}"
+       "${TRY_CRYPTO_REQUIRED_INCLUDES}"
+      OUTPUT_VARIABLE OUTPUT)
+  ENDIF()
 	# Inform user whether or not we found it; if not, log why we didn't.
         IF (ARCHIVE_CRYPTO_${ALGORITHM}_${IMPLEMENTATION})
           MESSAGE(STATUS "Checking support for ARCHIVE_CRYPTO_${ALGORITHM}_${IMPLEMENTATION} -- found")
