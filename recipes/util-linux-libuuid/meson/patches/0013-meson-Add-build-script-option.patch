From 4fa6e13a891bfcd8a3e52706a39051949fe8efa0 Mon Sep 17 00:00:00 2001
From: Jordan Williams <jordan@jwillikers.com>
Date: Mon, 22 Apr 2024 11:06:48 -0500
Subject: [PATCH 13/21] meson: Add build-script option

Signed-off-by: Jordan Williams <jordan@jwillikers.com>
(cherry picked from commit 44494e3ce327b17f9b5628501aaf544bd091673e)
---
 meson.build       | 18 ++++++++++++------
 meson_options.txt |  2 ++
 2 files changed, 14 insertions(+), 6 deletions(-)

diff --git a/meson.build b/meson.build
index 499ab75869..57581c5a6d 100644
--- a/meson.build
+++ b/meson.build
@@ -2457,6 +2457,7 @@ endif
 
 ############################################################
 
+opt = get_option('build-script').require(have_pty).allowed()
 exe = executable(
   'script',
   script_sources,
@@ -2467,10 +2468,13 @@ exe = executable(
                   realtime_libs,
                   math_libs],
   install_dir : usrbin_exec_dir,
-  install : true)
-exes += exe
-manadocs += ['term-utils/script.1.adoc']
-bashcompletions += ['script']
+  install : opt,
+  build_by_default : opt)
+if opt and not is_disabler(exe)
+  exes += exe
+  manadocs += ['term-utils/script.1.adoc']
+  bashcompletions += ['script']
+endif
 
 exe = executable(
   'test_script',
@@ -2482,8 +2486,10 @@ exe = executable(
                   lib_utempter,
                   realtime_libs,
                   math_libs],
-  build_by_default : program_tests)
-exes += exe
+  build_by_default : opt and program_tests)
+if opt and not is_disabler(exe)
+  exes += exe
+endif
 
 exe = executable(
   'scriptlive',
diff --git a/meson_options.txt b/meson_options.txt
index ef186db476..65b43fdb6d 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -69,6 +69,8 @@ option('build-fsck', type : 'feature',
        description : 'build fsck')
 option('build-partx', type : 'feature',
        description : 'build addpart, delpart, partx')
+option('build-script', type : 'feature',
+       description : 'build script')
 
 option('build-uuidd', type : 'feature',
        description : 'build the uuid daemon')
-- 
2.44.0

