From 4944a6688f39b6199855eaad2af661452477163a Mon Sep 17 00:00:00 2001
From: Jordan Williams <jordan@jwillikers.com>
Date: Tue, 23 Apr 2024 07:45:24 -0500
Subject: [PATCH 21/21] meson: Add build-lsclocks option

Signed-off-by: Jordan Williams <jordan@jwillikers.com>
(cherry picked from commit ce04cb6b0dff9f0d60316d6be7e4146ad7c7596e)
---
 meson.build       | 10 +++++++---
 meson_options.txt |  2 ++
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/meson.build b/meson.build
index 347b36453f..b40269e5c3 100644
--- a/meson.build
+++ b/meson.build
@@ -1643,7 +1643,9 @@ if opt and not is_disabler(exe)
   bashcompletions += ['ldattach']
 endif
 
-opt = get_option('build-rtcwake').require(cc.has_header('linux/rtc.h')).allowed()
+have_linux_rtc_h = cc.has_header('linux/rtc.h')
+
+opt = get_option('build-rtcwake').require(have_linux_rtc_h).allowed()
 exe = executable(
   'rtcwake',
   rtcwake_sources,
@@ -3122,14 +3124,16 @@ if opt and not is_disabler(exe)
   bashcompletions += ['enosys']
 endif
 
+opt = get_option('build-lsclocks').require(have_linux_rtc_h).allowed()
 exe = executable(
   'lsclocks',
   lsclocks_sources,
   include_directories : includes,
   link_with : [lib_common, lib_smartcols],
   install_dir : usrbin_exec_dir,
-  install : true)
-if not is_disabler(exe)
+  install : opt,
+  build_by_default : opt)
+if opt and not is_disabler(exe)
   exes += exe
   manadocs += ['misc-utils/lsclocks.1.adoc']
   bashcompletions += ['lsclocks']
diff --git a/meson_options.txt b/meson_options.txt
index 9f09f3220c..fedda65e50 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -205,6 +205,8 @@ option('build-fadvise', type : 'feature',
        description : 'build fadvise')
 option('build-enosys', type : 'feature',
        description : 'build enosys')
+option('build-lsclocks', type : 'feature',
+       description : 'build lsclocks')
 option('build-setterm', type : 'feature',
        description : 'build setterm')
 option('build-schedutils', type : 'feature',
-- 
2.44.0

