From 498b89c3c6657482e75791c2d506b5f67608cbf4 Mon Sep 17 00:00:00 2001
From: Jordan Williams <jordan@jwillikers.com>
Date: Mon, 22 Apr 2024 08:48:27 -0500
Subject: [PATCH 02/21] meson: Add build-blkzone option

Signed-off-by: Jordan Williams <jordan@jwillikers.com>
(cherry picked from commit ca42082d60de44534836571e109e14f3a47fcb61)
---
 meson.build       | 18 ++++++++++--------
 meson_options.txt |  2 ++
 2 files changed, 12 insertions(+), 8 deletions(-)

diff --git a/meson.build b/meson.build
index 06d42ae6c9..801f289067 100644
--- a/meson.build
+++ b/meson.build
@@ -1586,14 +1586,16 @@ exes += exe
 manadocs += ['sys-utils/blkdiscard.8.adoc']
 bashcompletions += ['blkdiscard']
 
-if cc.has_header('linux/blkzoned.h')
-  exe = executable(
-    'blkzone',
-    blkzone_sources,
-    include_directories : includes,
-    link_with : [lib_common],
-    install_dir : sbindir,
-    install : true)
+opt = get_option('build-blkzone').require(cc.has_header('linux/blkzoned.h')).allowed()
+exe = executable(
+  'blkzone',
+  blkzone_sources,
+  include_directories : includes,
+  link_with : [lib_common],
+  install_dir : sbindir,
+  install : opt,
+  build_by_default : opt)
+if opt and not is_disabler(exe)
   exes += exe
   manadocs += ['sys-utils/blkzone.8.adoc']
   bashcompletions += ['blkzone']
diff --git a/meson_options.txt b/meson_options.txt
index ecd395c3d3..862df4e917 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -141,6 +141,8 @@ option('build-fstrim', type : 'feature',
        description : 'build fstrim')
 option('build-dmesg', type : 'feature',
        description : 'build dmesg')
+option('build-blkzone', type : 'feature',
+       description : 'build blkzone')
 option('build-blkpr', type : 'feature',
        description : 'build blkpr')
 option('build-kill', type : 'feature',
-- 
2.44.0

