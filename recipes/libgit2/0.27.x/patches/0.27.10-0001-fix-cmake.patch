diff --git a/CMakeLists.txt b/CMakeLists.txt
index 83898c5..bc7934e 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -11,8 +11,8 @@
 # Install:
 # > cmake --build . --target install
 
-PROJECT(libgit2 C)
 CMAKE_MINIMUM_REQUIRED(VERSION 2.8.11)
+PROJECT(libgit2 C)
 CMAKE_POLICY(SET CMP0015 NEW)
 IF (POLICY CMP0051)
 	CMAKE_POLICY(SET CMP0051 NEW)
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 2080933..8b310fa 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -126,7 +126,7 @@ IF (WIN32 AND WINHTTP)
 	LIST(APPEND LIBGIT2_PC_LIBS "-lrpcrt4" "-lcrypt32" "-lole32")
 ELSE ()
 	IF (CURL)
-		FIND_PKGLIBRARIES(CURL libcurl)
+		FIND_PACKAGE(CURL REQUIRED)
 	ENDIF ()
 	IF (CURL_FOUND)
 		SET(GIT_CURL 1)
@@ -287,7 +287,11 @@ ENDIF()
 
 # Optional external dependency: libssh2
 IF (USE_SSH)
-	FIND_PKGLIBRARIES(LIBSSH2 libssh2)
+	FIND_PACKAGE(Libssh2 REQUIRED)
+	SET(LIBSSH2_FOUND ON)
+	SET(LIBSSH2_INCLUDE_DIRS ${Libssh2_INCLUDE_DIRS})
+	SET(LIBSSH2_LIBRARIES ${Libssh2_LIBRARIES})
+	SET(LIBSSH2_LIBRARY_DIRS ${Libssh2_LIB_DIRS})
 ENDIF()
 IF (LIBSSH2_FOUND)
 	SET(GIT_SSH 1)
@@ -295,10 +299,7 @@ IF (LIBSSH2_FOUND)
 	LIST(APPEND LIBGIT2_LIBS ${LIBSSH2_LIBRARIES})
 	LIST(APPEND LIBGIT2_PC_LIBS ${LIBSSH2_LDFLAGS})
 
-	CHECK_LIBRARY_EXISTS("${LIBSSH2_LIBRARIES}" libssh2_userauth_publickey_frommemory "${LIBSSH2_LIBRARY_DIRS}" HAVE_LIBSSH2_MEMORY_CREDENTIALS)
-	IF (HAVE_LIBSSH2_MEMORY_CREDENTIALS)
-		SET(GIT_SSH_MEMORY_CREDENTIALS 1)
-	ENDIF()
+	SET(GIT_SSH_MEMORY_CREDENTIALS 1)
 ELSE()
 	MESSAGE(STATUS "LIBSSH2 not found. Set CMAKE_PREFIX_PATH if it is installed outside of the default search path.")
 ENDIF()
