cmake_minimum_required(VERSION 2.8.12)
project(test_package CXX)

set(CMAKE_VERBOSE_MAKEFILE ON)

# Findprotoc.cmake generated by Conan does not give a hint where protoc is installed.
include(${CMAKE_BINARY_DIR}/conanbuildinfo.cmake)
conan_basic_setup()

find_package(protoc)

if (NOT protobuf_MODULE_COMPATIBLE)
    message(FATAL_ERROR "protobuf_MODULE_COMPATIBLE is mandatory")
endif()

PROTOBUF_GENERATE_CPP(PROTO_SRCS PROTO_HDRS addressbook.proto)
message(STATUS "PROTO_SRCS: ${PROTO_SRCS}")
message(STATUS "PROTO_HDRS: ${PROTO_HDRS}")

# Without a target, Protobuf will not generate sources and headers
add_executable(${CMAKE_PROJECT_NAME} "${PROTO_HDRS}" example.cpp)
