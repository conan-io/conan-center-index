cmake_minimum_required(VERSION 3.1)
project(cmake_wrapper)

if(WIN32)
    add_compile_definitions(NOGDI)
endif()
if(MSVC)
    add_compile_options(/bigobj)
endif()

# osgearth ships with custom cmake find modules. Unfortunately these set
# different variables than the ones generated by conan (most notably *_LIBRARY
# instead of *_LIBRARIES, but also different names). In the following
# these different variables are set using the variables set by conan's
# find modules.
macro(find_package_custom name)
    string(TOUPPER ${name} name_upper)
    find_package(${name} REQUIRED CONFIG
        # Forbid the use of system libs
        NO_DEFAULT_PATH
        PATHS ${CMAKE_PREFIX_PATH}
    )
    set(${name_upper}_FOUND ${${name}_FOUND})
    set(${name_upper}_LIBRARY ${${name}_LIBRARIES})
    set(${name_upper}_INCLUDE_DIR ${${name}_INCLUDE_DIRS})
    unset(name_upper)
endmacro()

find_package_custom(OSG REQUIRED CONFIG)
set(OSG_PLUGINS "osgPlugins-${OSG_VERSION}")
set(OSG_GEN_INCLUDE_DIR "${OSG_INCLUDE_DIRS}")

find_package_custom(GDAL REQUIRED CONFIG)

find_package_custom(CURL REQUIRED CONFIG)

# Unvendored dependencies
find_package_custom(RapidJSON REQUIRED CONFIG)
find_package_custom(lerc REQUIRED CONFIG)

# Optional dependencies
if (OSGEARTH_BUILD_ZIP_PLUGIN)
    find_package_custom(LibZip REQUIRED CONFIG)
endif ()

if (OSGEARTH_BUILD_LEVELDB_CACHE)
    find_package_custom(LevelDB REQUIRED CONFIG)
endif ()

if (WITH_BASISU)
    find_package_custom(BASISU REQUIRED CONFIG)
endif ()

if (WITH_BLEND2D)
    find_package_custom(Blend2D REQUIRED CONFIG)
endif ()

if (WITH_BLOSC)
    find_package_custom(Blosc REQUIRED CONFIG)
endif ()

if (WITH_DRACO)
    find_package_custom(Draco REQUIRED CONFIG)
endif ()

if (WITH_DUKTAPTE)
    find_package_custom(Duktape REQUIRED CONFIG)
endif ()

if (WITH_GEOS)
    find_package_custom(GEOS REQUIRED CONFIG)
endif ()

if (WITH_GLEW)
    find_package_custom(GLEW REQUIRED CONFIG)
endif ()

if (WITH_PROTOBUF)
    find_package_custom(Protobuf REQUIRED CONFIG)
endif ()

if (WITH_SPDLOG)
    find_package_custom(spdlog REQUIRED CONFIG)
endif ()

if (WITH_SQLITE3)
    find_package_custom(Sqlite3 REQUIRED CONFIG)
endif ()

if (WITH_TINYXML)
    find_package_custom(TinyXML REQUIRED CONFIG)
endif ()

if (WITH_TRACY)
    find_package_custom(Tracy REQUIRED CONFIG)
endif ()

if (WITH_WEBP)
    find_package_custom(WEBP REQUIRED CONFIG)
endif ()

include_directories("${OSGEARTH_SRC_DIR}/src/osgEarth")

add_subdirectory(${OSGEARTH_SRC_DIR})
