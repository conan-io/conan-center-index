name: 'Validate yml files'
description: ' Validate yml files'
author: 'ericLemanissier'
inputs:
  files:
    description: "yml files to check"
    required: true
  python_version:
    description: "python version to use for linting"
    required: true
  python_linter:
    description: "path to python linter script"
    required: true

runs:
  using: "composite"
  steps:
    - uses: actions/setup-python@v4
      with:
        python-version: ${{ inputs.python_version }}

    - name: Install dependencies
      shell: bash
      run: pip install yamllint strictyaml argparse

    - name: Run linter
      if: always()
      shell: bash
      run: |
        echo "::add-matcher::linter/yamllint_matcher.json"
        set -o noglob
        res=0
        for file in ${{ inputs.files }}; do
          set +o noglob
          yamllint --config-file linter/yamllint_rules.yml -f standard ${file} || res=$?
        done
        echo "::remove-matcher owner=yamllint_matcher::"
        exit $res
    - name: Run schema check
      if: always()
      shell: bash
      run: |
        res=0
        for file in ${{ inputs.files }}; do
          python3 ${{ inputs.python_linter }} ${file} || res=$?
        done
        exit $res
